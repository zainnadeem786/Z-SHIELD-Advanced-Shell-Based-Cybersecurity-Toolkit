#!/bin/bash

# Z-SHIELD Malware Analysis Module
# Author: ZAIN NADEEM
# Purpose: Local static analysis of potentially malicious files

# Colors
RED="\033[1;31m"
GREEN="\033[1;32m"
YELLOW="\033[1;33m"
CYAN="\033[1;36m"
MAGENTA="\033[1;35m"
RESET="\033[0m"
BOLD="\033[1m"

# Banner
clear
echo -e "${GREEN}${BOLD}"
figlet -f ANSI_Shadow "MALWARE Module" | lolcat
echo -e "${CYAN}${BOLD}         Z-SHIELD Exploitation Module${RESET}"
echo -e "${YELLOW}          Developed by ${RESET}${WHITE}ZAIN NADEEM${RESET}"
echo ""

read -p "$(echo -e ${YELLOW}Enter full path to suspicious file: ${RESET})" MALFILE

if [ ! -f "$MALFILE" ]; then
    echo -e "${RED}[✗] File not found. Exiting.${RESET}"
    exit 1
fi

# Display File Info
echo -e "${CYAN}\n[✓] Basic File Info:${RESET}"
file "$MALFILE"
ls -lh "$MALFILE"

# MD5 / SHA Hashes
echo -e "${CYAN}\n[✓] File Hashes:${RESET}"
echo -e "${GREEN}MD5:${RESET}     $(md5sum "$MALFILE" | awk '{print $1}')"
echo -e "${GREEN}SHA256:${RESET}  $(sha256sum "$MALFILE" | awk '{print $1}')"

# Strings Analysis
echo -e "${CYAN}\n[✓] Printing useful strings (first 20 lines)...${RESET}"
strings "$MALFILE" | head -n 20

# ELF Binary Analysis
if file "$MALFILE" | grep -iq "elf"; then
    echo -e "${CYAN}\n[✓] ELF Binary Detected. Showing details...${RESET}"
    echo -e "${GREEN}Architecture:${RESET} $(readelf -h "$MALFILE" | grep 'Class:' | awk '{print $2,$3}')"
    echo -e "${GREEN}Entry Point:${RESET} $(readelf -h "$MALFILE" | grep 'Entry point' | awk '{print $4}')"
    echo -e "${GREEN}Linked Libraries:${RESET}"
    ldd "$MALFILE" 2>/dev/null || echo -e "${YELLOW}Could not determine shared libs.${RESET}"
fi

# Hex View (First 16 Lines)
echo -e "${CYAN}\n[✓] Hex Dump (first 16 lines):${RESET}"
hexdump -C "$MALFILE" | head -n 16

# Check for Obfuscation
echo -e "${CYAN}\n[✓] Detecting potential encoding or obfuscation...${RESET}"
ENCODED=$(xxd "$MALFILE" | grep -E '00 00 00|ff ff ff|cc cc cc' | wc -l)
if [ "$ENCODED" -gt 5 ]; then
    echo -e "${YELLOW}[!] High chance of obfuscation or filler detected.${RESET}"
else
    echo -e "${GREEN}[✓] No strong indicators of binary obfuscation.${RESET}"
fi

# ClamAV Scan (Optional - Preinstalled in Kali)
echo -e "${CYAN}\n[✓] Running ClamAV scan (signature-based)...${RESET}"
clamscan "$MALFILE"

echo -e "${MAGENTA}\n[✓] Malware analysis completed.${RESET}\n"
